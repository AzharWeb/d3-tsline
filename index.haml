%html
  %head
    %title d3-tsline
    %link{:href => "css/d3.tsline.css", :media => "screen", :rel => "stylesheet", :type => "text/css"}
  :css
    #container {
      font: 10px sans-serif;
      margin: 0px auto 22px;
      clear: both;
      width: 960px;
    }

  %body
    #container
      #chart
    %script{:src => "js/d3.js", :type => "text/javascript"}
    %script{:src => "js/d3.csv.js", :type => "text/javascript"}
    %script{:src => "js/d3.time.js", :type => "text/javascript"}
    %script{:src => "js/d3.tsline.js", :type => "text/javascript"}

    :javascript

      // make mychart object
      var mychart = new d3_tsline("#chart");

      // override format_data function, taking json payload and creating
      // 2-arrays as data points in a series.  Return an array of one series
      mychart.format_data = function(data) {
          var series = [];
          data[0].forEach(function(json) {
              series.push([json.date, json.val]);
          });
          return [ series ];
      };

      // override parse_date function to handle our data's date format
      mychart.parse_date = d3.time.format("%b %d, %Y").parse;

      // add some metadata about the series
      mychart.series = [
          {
              "name" : "AAPL",
              "css"  : "aapl"
          }
      ];

      // fetch data and draw the chart
      var url = "aapl.csv";
      d3.csv(url, function(data) {
          mychart.setSeriesData([data]);
          mychart.render();
      });
